generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Company {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  phone       String?
  address     String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  
  users       User[]
  employees   Employee[]
  sites       Site[]
  workTypes   WorkType[]
  payers      Payer[]
  attendance  Attendance[]
  transactions Transaction[]
}

model User {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  companyId     String   @db.ObjectId
  company       Company  @relation(fields: [companyId], references: [id])
  email         String   @unique
  passwordHash  String
  role          String   @default("user") // admin, user
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
}

model Employee {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  companyId    String   @db.ObjectId
  company      Company  @relation(fields: [companyId], references: [id])
  name         String
  phone        String?
  type         String   @default("daily") // daily, salary
  defaultWage  Float    @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  
  attendance   Attendance[]
  transactions Transaction[]
}

model Site {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  companyId String   @db.ObjectId
  company   Company  @relation(fields: [companyId], references: [id])
  name      String
  location  String?
  
  attendance Attendance[]
}

model WorkType {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  companyId String   @db.ObjectId
  company   Company  @relation(fields: [companyId], references: [id])
  name      String   // Mason, Helper, etc.
  
  attendance Attendance[]
}

model Payer {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  companyId   String   @db.ObjectId
  company     Company  @relation(fields: [companyId], references: [id])
  name        String
  contactInfo String?
  
  attendance Attendance[]
}

model Attendance {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  companyId   String   @db.ObjectId
  company     Company  @relation(fields: [companyId], references: [id])
  employeeId  String   @db.ObjectId
  employee    Employee @relation(fields: [employeeId], references: [id])
  siteId      String   @db.ObjectId
  site        Site     @relation(fields: [siteId], references: [id])
  workTypeId  String   @db.ObjectId
  workType    WorkType @relation(fields: [workTypeId], references: [id])
  payerId     String   @db.ObjectId
  payer       Payer    @relation(fields: [payerId], references: [id])
  date        DateTime
  wage        Float
  isPresent   Boolean  @default(true)
  createdAt   DateTime @default(now())
  
  transactions Transaction[]
}

model Transaction {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  companyId    String   @db.ObjectId
  company      Company  @relation(fields: [companyId], references: [id])
  employeeId   String   @db.ObjectId
  employee     Employee @relation(fields: [employeeId], references: [id])
  attendanceId String?  @db.ObjectId
  attendance   Attendance? @relation(fields: [attendanceId], references: [id])
  type         String   // advance, payment, salary_credit
  amount       Float
  date         DateTime
  note         String?
  createdAt    DateTime @default(now())
}
